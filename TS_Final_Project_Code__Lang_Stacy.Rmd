---
title: "Time Series Study on CO2 Emissions and Hybrid Car Sales Project"
author: "Grace Lang & Jules Stacy"
date: "3/18/2021"
output: html_document
---
# Data sources: 
* Hybrid Car sales: https://afdc.energy.gov/data/10301
* CO2 Emissions by Country: https://data.worldbank.org/indicator/EN.ATM.CO2E.PC?view=map

* Turbine data citation:
* Hoen, B.D., Diffendorfer, J.E., Rand, J.T., Kramer, L.A., Garrity, C.P., and Hunt, H.E., 2018, United States Wind Turbine Database (ver. 3.3, January 14, 2021): U.S. Geological Survey, American Clean Power Association, and Lawrence Berkeley National Laboratory data release, https://doi.org/10.5066/F7TX3DN0.

# EDA / Notes for Initial Presentation: 
a.	Identify yourself and your partner (if applicable).  Goal 1
b.	Describe the Data Set / Time Series (Who, What, When, Where, Why and How) Goal 1
c.	Stationary / Non-Stationary Goal 2
d.	ACFs and Spectral Densities just to explore Goal 2
e.	At least 2 (total) candidate ARMA / ARIMA models (univariate) Goal 2
    a.	The models in factored form or at least separate the stationary and non-
stationary factors with standard deviation or variance of the white noise.
    b.	AIC
    c.	ASE (Rolling window)
    d.	Visualization of Forecasts (Short and Long Term / State and National) 
f.	Strategy / Plans for the rest of the analysis.


```{r setup, include=FALSE}
library(tswge)
library(dplyr)

car_orig <- read.csv("./HybridCar.csv")

#Remove years that are majority blank
car <- car_orig[40:60,]

#Rename column to something easier
names(car)[names(car) == "CO2.emissions..metric.tons.per.capita."] <- "CO2"

#Loading in the wind turbine data
turbine <- read.csv("./turbines.csv")

turbine_tot = aggregate(turbine$p_tnum, by=list(Category=turbine$p_year), FUN=sum)
turbine_tot
#Renaming wind turbine column
names(turbine_tot)[names(turbine_tot) == "x"] <- "wind"
plotts.sample.wge(turbine_tot$wind)

#Jules - this merge didnt pull in the wind turbine data 
#alldat = merge(car_orig, turbine_tot, by.x=c('USA'), by.y=c('Category'), all=TRUE)


# Data cleanup

#turbine data is missing 1993
library(DataCombine)
x<- turbine_tot[1:35,]
x<- x %>% add_row(Category = 1993, wind = 0, .before = 13)
#shorten to just the years with cross-over data
y<- car_orig[22:57,1:3]
#combine the 2 datasets
alldata <- cbind(x,y)
alldata <- select(alldata,-USA) #remove duplicate year column that was for reference
#Rename column to something easier
names(alldata)[names(alldata) == "CO2.emissions..metric.tons.per.capita."] <- "CO2"
```

# Initial look at data plotted out
Data cut differently by years where data is available
```{r}
plotts.wge(car$CO2)
plotts.wge(car$TotalSales)

car_1 <- car_orig[40:57,]
plotts.sample.wge(car_1$CO2)

co2_total <- car_orig[1:57,]
names(co2_total)[names(co2_total) == "CO2.emissions..metric.tons.per.capita."] <- "CO2"
plotts.sample.wge(co2_total$CO2)
```



# First take of some ARIMA Models
```{r}
#ARIMA Model Plotting
plotts.sample.wge(co2_total$CO2)
aic5.wge(co2_total$CO2,p=0:10) #AIC shows an ARMA(1,1) s best fit 
aic5.wge(co2_total$CO2, type="bic") #BIC shows an ARMA(1,1) s best fit 

#fit the model -- ARMA(1.1)
est.arma.wge(co2_total$CO2, p=1, q=1)
m1 = fore.arma.wge(co2_total$CO2,phi=0.9261945,theta = -0.5741199 , n.ahead = 5,lastn=TRUE,  plot=TRUE)
mean((co2_total$CO2[53:57]-m1$f)^2)
#ASE =  0.8390832

#Using the ARMA(1,1) to plot the 5 years ahead
fore.arma.wge(co2_total$CO2,phi=0.9261945,theta = -0.5741199 , n.ahead = 5,lastn=FALSE,  plot=TRUE)
#Using the ARMA(1,1) to plot the 20 years ahead
fore.arma.wge(co2_total$CO2,phi=0.9261945,theta = -0.5741199 , n.ahead = 20,lastn=FALSE,  plot=TRUE)
```

